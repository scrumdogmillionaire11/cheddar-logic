---
phase: 05-launch-prep
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/vite.config.ts
  - frontend/vercel.json
  - backend/railway.json
  - backend/.env.example
  - backend/Procfile
autonomous: true

must_haves:
  truths:
    - "Frontend builds successfully for production with /fpl-sage base path"
    - "Backend can start with production environment variables"
    - "Deployment configs reference correct build commands and output directories"
  artifacts:
    - path: "frontend/vercel.json"
      provides: "Vercel deployment configuration"
      contains: "basePath"
    - path: "frontend/vite.config.ts"
      provides: "Vite build with base path"
      contains: "base:"
    - path: "backend/railway.json"
      provides: "Railway service configuration"
      contains: "build"
    - path: "backend/.env.example"
      provides: "Production environment variable template"
      min_lines: 10
    - path: "backend/Procfile"
      provides: "Backend startup command"
      contains: "uvicorn"
  key_links:
    - from: "frontend/vercel.json"
      to: "frontend/vite.config.ts"
      via: "base path consistency"
      pattern: "basePath.*fpl-sage"
    - from: "backend/railway.json"
      to: "backend/Procfile"
      via: "startup command reference"
      pattern: "Procfile|start"
---

<objective>
Configure production build and deployment settings for Vercel (frontend) and Railway (backend). Ensure base path routing, environment variable templates, and platform-specific configurations are ready for deployment.

Purpose: Foundation for production deployment. Without proper configs, deployments will fail or route incorrectly.
Output: Deployment configuration files for both frontend and backend platforms.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-launch-prep/05-CONTEXT.md

# Frontend structure
@frontend/vite.config.ts
@frontend/package.json

# Backend structure
@backend/requirements.txt
</context>

<tasks>

<task type="auto">
  <name>Configure frontend for Vercel with base path</name>
  <files>
    frontend/vercel.json
    frontend/vite.config.ts
  </files>
  <action>
Create `frontend/vercel.json` with:
- `basePath: "/fpl-sage"` (path-based routing per user requirement)
- `buildCommand: "npm run build"`
- `outputDirectory: "dist"`
- `framework: "vite"`
- Rewrites for SPA routing (/* -> /index.html)
- Headers for CORS if needed for API calls

Update `frontend/vite.config.ts`:
- Add `base: "/fpl-sage/"` to defineConfig (must match Vercel basePath)
- Keep existing proxy config for dev server
- Ensure asset paths will be correct with base path

Test build locally:
```bash
cd frontend
npm run build
# Verify dist/ contains index.html with correct asset paths
```
  </action>
  <verify>
Run `cd frontend && npm run build` - build succeeds with no errors.
Check `frontend/dist/index.html` contains script/link tags with `/fpl-sage/` prefix.
  </verify>
  <done>
Frontend builds successfully for production. Vercel config exists with basePath. Vite config has matching base setting.
  </done>
</task>

<task type="auto">
  <name>Configure backend for Railway deployment</name>
  <files>
    backend/railway.json
    backend/.env.example
    backend/Procfile
  </files>
  <action>
Create `backend/railway.json` with:
- `build.builder: "NIXPACKS"`
- `deploy.startCommand: "uvicorn main:app --host 0.0.0.0 --port $PORT"`
- `deploy.healthcheckPath: "/api/v1/health"` (if health endpoint exists, otherwise "/")
- Environment variable references: `REDIS_URL`, `FPL_API_BASE_URL`, `CORS_ORIGINS`

Create `backend/.env.example` template documenting all required environment variables:
```
# FPL API
FPL_API_BASE_URL=https://fantasy.premierleague.com/api

# Redis (provided by Railway)
REDIS_URL=redis://localhost:6379

# CORS
CORS_ORIGINS=https://cheddarlogic.com

# Rate Limiting
RATE_LIMIT_REQUESTS_PER_HOUR=100

# Sentry (add later in monitoring plan)
# SENTRY_DSN=

# Discord Webhook (add later in monitoring plan)
# DISCORD_WEBHOOK_URL=
```

Create `backend/Procfile` (Railway fallback):
```
web: uvicorn main:app --host 0.0.0.0 --port ${PORT:-8000}
```

Note: Railway auto-detects Python and uses requirements.txt. Procfile is backup.
  </action>
  <verify>
Check files exist: `backend/railway.json`, `backend/.env.example`, `backend/Procfile`.
Verify railway.json has valid JSON structure.
Verify .env.example documents at least 5 environment variables.
  </verify>
  <done>
Backend has Railway deployment config with startup command. Environment variable template exists. Procfile created as fallback.
  </done>
</task>

</tasks>

<verification>
Run `cd frontend && npm run build` - succeeds and produces dist/ with /fpl-sage/ prefixed assets.
Verify `backend/railway.json` references uvicorn startup command.
Verify `backend/.env.example` documents REDIS_URL, CORS_ORIGINS, FPL_API_BASE_URL.
Check both configs are valid JSON (no syntax errors).
</verification>

<success_criteria>
- Frontend builds successfully with /fpl-sage base path
- Vercel config exists and references correct build command
- Backend Railway config exists with uvicorn startup
- Environment variable template documents all required vars
- Procfile exists as deployment fallback
- No build errors or warnings
</success_criteria>

<output>
After completion, create `.planning/phases/05-launch-prep/05-01-SUMMARY.md`
</output>
