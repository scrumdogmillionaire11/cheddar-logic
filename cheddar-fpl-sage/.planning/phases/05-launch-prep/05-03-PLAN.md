---
phase: 05-launch-prep
plan: 03
type: execute
wave: 2
depends_on: ["05-01"]
files_modified: []
autonomous: false

user_setup:
  - service: vercel
    why: "Frontend hosting"
    env_vars: []
    dashboard_config:
      - task: "Connect GitHub repository (if not already connected)"
        location: "Vercel Dashboard -> New Project"
      - task: "Note deployment URL after first deploy"
        location: "Vercel Dashboard -> Project -> Deployments"
  - service: railway
    why: "Backend hosting with Redis"
    env_vars:
      - name: REDIS_URL
        source: "Auto-provided by Railway Redis plugin"
      - name: CORS_ORIGINS
        source: "Set to https://cheddarlogic.com (or Vercel preview URL initially)"
    dashboard_config:
      - task: "Add Redis plugin to project"
        location: "Railway Dashboard -> Project -> New -> Database -> Redis"
      - task: "Note backend deployment URL"
        location: "Railway Dashboard -> Project -> Service -> Settings -> Domains"
  - service: cloudflare
    why: "DNS routing for cheddarlogic.com/fpl-sage"
    env_vars: []
    dashboard_config:
      - task: "Update DNS records if needed (CNAME for api subdomain OR proxy rules for /api/*)"
        location: "Cloudflare Dashboard -> cheddarlogic.com -> DNS"

must_haves:
  truths:
    - "Frontend is deployed and accessible at cheddarlogic.com/fpl-sage"
    - "Backend is deployed and responding to API requests"
    - "Frontend can communicate with backend API"
    - "DNS routing works correctly (frontend and API paths resolve)"
  artifacts:
    - path: ".vercel/project.json"
      provides: "Vercel project metadata"
      contains: "projectId"
    - path: "backend/.railway"
      provides: "Railway deployment metadata (optional)"
      contains: ""
  key_links:
    - from: "frontend (Vercel)"
      to: "backend (Railway)"
      via: "API calls to backend URL"
      pattern: "fetch.*api"
    - from: "cheddarlogic.com/fpl-sage"
      to: "Vercel deployment"
      via: "DNS CNAME or proxy"
      pattern: "CNAME|proxy"
---

<objective>
Deploy frontend to Vercel and backend to Railway. Verify production deployments work, API communication functions, and DNS routing is correct for cheddarlogic.com/fpl-sage path-based setup.

Purpose: Go live. Make FPL Sage accessible to users.
Output: Working production deployments with verified API communication.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-launch-prep/05-CONTEXT.md
@.planning/phases/05-launch-prep/05-01-SUMMARY.md

# Deployment configs created in Plan 01
@frontend/vercel.json
@backend/railway.json
@backend/.env.example
</context>

<tasks>

<task type="auto">
  <name>Deploy frontend to Vercel</name>
  <files></files>
  <action>
Install Vercel CLI if not present:
```bash
npm install -g vercel
```

Deploy frontend:
```bash
cd frontend
vercel --yes
```

Follow prompts:
- Link to existing project or create new
- Set project name: "fpl-sage-frontend" or similar
- Framework preset: Vite (auto-detected)
- Build command: `npm run build` (auto-detected)
- Output directory: `dist` (auto-detected)
- Deploy to production: Yes

After deployment:
- Note deployment URL (e.g., fpl-sage-frontend.vercel.app)
- Verify /fpl-sage base path is working

Add custom domain in Vercel Dashboard (optional, can be done manually):
- Domain: cheddarlogic.com
- Path: /fpl-sage
- This requires Cloudflare DNS configuration (user will handle in verification)

If CLI prompts for authentication, pause and create checkpoint for user to authenticate via browser.
  </action>
  <verify>
Run `curl https://[vercel-url]/fpl-sage/` - returns HTML with FPL Sage content.
Check Vercel Dashboard shows deployment as "Ready".
Verify build logs show successful build with /fpl-sage base path.
  </verify>
  <done>
Frontend deployed to Vercel. Deployment URL noted. Base path /fpl-sage working on Vercel domain.
  </done>
</task>

<task type="auto">
  <name>Deploy backend to Railway</name>
  <files></files>
  <action>
Install Railway CLI if not present:
```bash
npm install -g @railway/cli
# OR
brew install railway
```

Initialize Railway project:
```bash
cd backend
railway login
railway init
```

Set environment variables via CLI:
```bash
railway variables set FPL_API_BASE_URL=https://fantasy.premierleague.com/api
railway variables set RATE_LIMIT_REQUESTS_PER_HOUR=100
railway variables set CORS_ORIGINS=https://cheddarlogic.com
```

Add Redis plugin via CLI:
```bash
railway add -p redis
```
Railway will auto-provide REDIS_URL environment variable.

Deploy:
```bash
railway up
```

After deployment:
- Note deployment URL (e.g., fpl-sage-backend.up.railway.app)
- Verify health endpoint responds: `curl https://[railway-url]/api/v1/health`

If CLI prompts for authentication, pause and create checkpoint for user to authenticate via browser.
  </action>
  <verify>
Run `curl https://[railway-url]/api/v1/health` - returns 200 OK.
Check Railway Dashboard shows service as "Active".
Verify Redis plugin is connected and REDIS_URL is set.
Check environment variables are configured correctly.
  </verify>
  <done>
Backend deployed to Railway. Deployment URL noted. Redis connected. Health endpoint responding.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Frontend and backend deployed to production (Vercel + Railway). Both services should be live and accessible via their deployment URLs.
  </what-built>
  <how-to-verify>
1. Visit Vercel deployment URL (e.g., https://fpl-sage-frontend.vercel.app/fpl-sage/)
   - Should see FPL Sage landing page
   - Try entering a team ID and running analysis
   - Verify WebSocket connection works (progress updates appear)

2. Test backend directly:
   - `curl https://[railway-url]/api/v1/health` -> 200 OK
   - Try POST to /api/v1/analyze with test team_id
   - Verify rate limiting and usage tracking work

3. Check Cloudflare DNS:
   - Visit https://cheddarlogic.com/fpl-sage/
   - Should load frontend OR show DNS not configured yet
   - If not working, configure Cloudflare:
     - For api.cheddarlogic.com approach: Add CNAME record pointing to Railway URL
     - For cheddarlogic.com/api/* approach: Add proxy rule or rewrite in Vercel

4. Test end-to-end flow:
   - Enter team ID at https://cheddarlogic.com/fpl-sage/ (or Vercel URL if DNS pending)
   - Complete 6-step form
   - Submit analysis
   - Verify progress updates stream correctly
   - Check results load with all tabs (Transfers, Captain, Chips, XI)
   - Verify usage counter displays correctly

Expected behavior:
- Frontend loads at /fpl-sage path
- API calls go to Railway backend
- WebSocket connects and streams progress
- Results display correctly
- Usage limits enforce after 2 analyses

If any issues, note them and we'll address in gap closure.
  </how-to-verify>
  <resume-signal>
Type "approved" if production deployment works end-to-end, or describe any issues found.
  </resume-signal>
</task>

</tasks>

<verification>
Verify frontend deployment:
- Vercel URL loads FPL Sage UI
- Base path /fpl-sage works correctly
- Static assets load (JS, CSS)

Verify backend deployment:
- Railway URL responds to health checks
- Redis is connected (REDIS_URL set)
- Environment variables configured

Verify API communication:
- Frontend can POST to backend /api/v1/analyze
- WebSocket connection establishes successfully
- Results return correctly

Verify DNS (if configured):
- cheddarlogic.com/fpl-sage resolves to Vercel
- API routing (api.cheddarlogic.com or /api/*) resolves to Railway
</verification>

<success_criteria>
- Frontend deployed to Vercel with /fpl-sage base path
- Backend deployed to Railway with Redis connected
- Both services accessible via deployment URLs
- Health checks pass for both services
- End-to-end flow works (team entry -> analysis -> results)
- DNS routing works (or documented what user needs to configure)
- User has verified production deployment
</success_criteria>

<output>
After completion, create `.planning/phases/05-launch-prep/05-03-SUMMARY.md`
</output>
